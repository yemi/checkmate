// Generated by psc version 0.8.5.0
"use strict";
var Prelude = require("../Prelude");
var Data_Maybe = require("../Data.Maybe");
var Data_Array = require("../Data.Array");
var Data_Tuple = require("../Data.Tuple");
var Data_Either = require("../Data.Either");
var Data_Foreign = require("../Data.Foreign");
var Data_Foreign_Index = require("../Data.Foreign.Index");
var Data_Function = require("../Data.Function");
var Data_Nullable = require("../Data.Nullable");
var Data_Generic = require("../Data.Generic");
var Data_Foldable = require("../Data.Foldable");
var Data_Traversable = require("../Data.Traversable");
var Data_List = require("../Data.List");
var Data_StrMap = require("../Data.StrMap");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Eff_Exception_Unsafe = require("../Control.Monad.Eff.Exception.Unsafe");
var Global_Unsafe = require("../Global.Unsafe");
var Type_Proxy = require("../Type.Proxy");
var TaggedObject = (function () {
    function TaggedObject(value0) {
        this.value0 = value0;
    };
    TaggedObject.create = function (value0) {
        return new TaggedObject(value0);
    };
    return TaggedObject;
})();
var toForeignGeneric = function (dictGeneric) {
    return function (v) {
        var go = function (v1) {
            return function (v2) {
                if (v2 instanceof Data_Generic.SNumber) {
                    return Data_Foreign.toForeign(v2.value0);
                };
                if (v2 instanceof Data_Generic.SInt) {
                    return Data_Foreign.toForeign(v2.value0);
                };
                if (v2 instanceof Data_Generic.SChar) {
                    return Data_Foreign.toForeign(v2.value0);
                };
                if (v2 instanceof Data_Generic.SString) {
                    return Data_Foreign.toForeign(v2.value0);
                };
                if (v2 instanceof Data_Generic.SBoolean) {
                    return Data_Foreign.toForeign(v2.value0);
                };
                if (v1 instanceof Data_Generic.SigArray && v2 instanceof Data_Generic.SArray) {
                    return Data_Foreign.toForeign(Prelude.map(Prelude.functorArray)(function ($167) {
                        return go(v1.value0(Prelude.unit))((function (v3) {
                            return v3(Prelude.unit);
                        })($167));
                    })(v2.value0));
                };
                if (v1 instanceof Data_Generic.SigRecord && v2 instanceof Data_Generic.SRecord) {
                    var pair = function (sig) {
                        return function (sp) {
                            if (sig.recLabel === sp.recLabel) {
                                return new Data_Tuple.Tuple(sig.recLabel, go(sig.recValue(Prelude.unit))(sp.recValue(Prelude.unit)));
                            };
                            if (Prelude.otherwise) {
                                return Control_Monad_Eff_Exception_Unsafe.unsafeThrow("Record fields do not match signature");
                            };
                            throw new Error("Failed pattern match at Data.Foreign.Generic line 135, column 5 - line 136, column 5: " + [ sig.constructor.name, sp.constructor.name ]);
                        };
                    };
                    var pairs = Data_Array.zipWith(pair)(Data_Array.sortBy(Data_Function.on(Prelude.compare(Prelude.ordString))(function (v3) {
                        return v3.recLabel;
                    }))(v1.value0))(Data_Array.sortBy(Data_Function.on(Prelude.compare(Prelude.ordString))(function (v3) {
                        return v3.recLabel;
                    }))(v2.value0));
                    return Data_Foreign.toForeign(Data_StrMap.fromList(Data_List.toList(Data_Foldable.foldableArray)(pairs)));
                };
                if (v1 instanceof Data_Generic.SigProd && (v1.value0 === "Data.Maybe.Maybe" && (v2 instanceof Data_Generic.SProd && (v2.value0 === "Data.Maybe.Nothing" && (v2.value1.length === 0 && v.maybeAsNull))))) {
                    return Data_Foreign.toForeign(Data_Nullable.toNullable(Data_Maybe.Nothing.value));
                };
                if (v1 instanceof Data_Generic.SigProd && (v1.value0 === "Data.Maybe.Maybe" && (v1.value1.length === 2 && ((v1.value1[0]).sigValues.length === 1 && (v2 instanceof Data_Generic.SProd && (v2.value0 === "Data.Maybe.Just" && (v2.value1.length === 1 && v.maybeAsNull))))))) {
                    return go((v1.value1[0]).sigValues[0](Prelude.unit))(v2.value1[0](Prelude.unit));
                };
                if (v1 instanceof Data_Generic.SigProd && (v1.value0 === "Data.Tuple.Tuple" && (v1.value1.length === 1 && ((v1.value1[0]).sigValues.length === 2 && (v2 instanceof Data_Generic.SProd && (v2.value0 === "Data.Tuple.Tuple" && (v2.value1.length === 2 && v.tupleAsArray))))))) {
                    return Data_Foreign.toForeign([ go((v1.value1[0]).sigValues[0](Prelude.unit))(v2.value1[0](Prelude.unit)), go((v1.value1[0]).sigValues[1](Prelude.unit))(v2.value1[1](Prelude.unit)) ]);
                };
                if (v1 instanceof Data_Generic.SigProd && (v1.value1.length === 1 && ((v1.value1[0]).sigValues.length === 1 && (v2 instanceof Data_Generic.SProd && (v2.value1.length === 1 && v.unwrapNewtypes))))) {
                    return go((v1.value1[0]).sigValues[0](Prelude.unit))(v2.value1[0](Prelude.unit));
                };
                if (v1 instanceof Data_Generic.SigProd && v2 instanceof Data_Generic.SProd) {
                    var $81 = Data_Foldable.find(Data_Foldable.foldableArray)(function (alt) {
                        return alt.sigConstructor === v2.value0;
                    })(v1.value1);
                    if ($81 instanceof Data_Maybe.Nothing) {
                        return Control_Monad_Eff_Exception_Unsafe.unsafeThrow("No signature for data constructor " + v2.value0);
                    };
                    if ($81 instanceof Data_Maybe.Just) {
                        var $82 = Data_Array.zipWith(function (sig) {
                            return function (sp) {
                                return go(sig(Prelude.unit))(sp(Prelude.unit));
                            };
                        })($81.value0.sigValues)(v2.value1);
                        if ($82.length === 0) {
                            return Data_Foreign.toForeign(Data_StrMap.fromList(Data_List.singleton(new Data_Tuple.Tuple(v.sumEncoding.value0.tagFieldName, Data_Foreign.toForeign(v2.value0)))));
                        };
                        if ($82.length === 1 && v.unwrapSingleArgumentConstructors) {
                            return Data_Foreign.toForeign(Data_StrMap.fromList(Data_List.toList(Data_Foldable.foldableArray)([ new Data_Tuple.Tuple(v.sumEncoding.value0.tagFieldName, Data_Foreign.toForeign(v2.value0)), new Data_Tuple.Tuple(v.sumEncoding.value0.contentsFieldName, $82[0]) ])));
                        };
                        return Data_Foreign.toForeign(Data_StrMap.fromList(Data_List.toList(Data_Foldable.foldableArray)([ new Data_Tuple.Tuple(v.sumEncoding.value0.tagFieldName, Data_Foreign.toForeign(v2.value0)), new Data_Tuple.Tuple(v.sumEncoding.value0.contentsFieldName, Data_Foreign.toForeign($82)) ])));
                    };
                    throw new Error("Failed pattern match at Data.Foreign.Generic line 149, column 9 - line 161, column 3: " + [ $81.constructor.name ]);
                };
                return Control_Monad_Eff_Exception_Unsafe.unsafeThrow("Invalid spine for signature");
            };
        };
        return function ($168) {
            return go(Data_Generic.toSignature(dictGeneric)((Type_Proxy["Proxy"]).value))(Data_Generic.toSpine(dictGeneric)($168));
        };
    };
};
var toJSONGeneric = function (dictGeneric) {
    return function (opts) {
        return function ($169) {
            return Global_Unsafe.unsafeStringify(toForeignGeneric(dictGeneric)(opts)($169));
        };
    };
};
var readGeneric = function (dictGeneric) {
    return function (v) {
        var go = function (v1) {
            return function (f) {
                if (v1 instanceof Data_Generic.SigNumber) {
                    return Prelude.map(Data_Either.functorEither)(Data_Generic.SNumber.create)(Data_Foreign.readNumber(f));
                };
                if (v1 instanceof Data_Generic.SigInt) {
                    return Prelude.map(Data_Either.functorEither)(Data_Generic.SInt.create)(Data_Foreign.readInt(f));
                };
                if (v1 instanceof Data_Generic.SigChar) {
                    return Prelude.map(Data_Either.functorEither)(Data_Generic.SChar.create)(Data_Foreign.readChar(f));
                };
                if (v1 instanceof Data_Generic.SigString) {
                    return Prelude.map(Data_Either.functorEither)(Data_Generic.SString.create)(Data_Foreign.readString(f));
                };
                if (v1 instanceof Data_Generic.SigBoolean) {
                    return Prelude.map(Data_Either.functorEither)(Data_Generic.SBoolean.create)(Data_Foreign.readBoolean(f));
                };
                if (v1 instanceof Data_Generic.SigArray) {
                    return Prelude.bind(Data_Either.bindEither)(Data_Foreign.readArray(f))(function (v2) {
                        return Prelude.bind(Data_Either.bindEither)(Data_Traversable["for"](Data_Either.applicativeEither)(Data_Traversable.traversableArray)(v2)(function (f2) {
                            return Prelude.bind(Data_Either.bindEither)(go(v1.value0(Prelude.unit))(f2))(function (v3) {
                                return Prelude["return"](Data_Either.applicativeEither)(Prelude["const"](v3));
                            });
                        }))(function (v3) {
                            return Prelude["return"](Data_Either.applicativeEither)(new Data_Generic.SArray(v3));
                        });
                    });
                };
                if (v1 instanceof Data_Generic.SigRecord) {
                    return Prelude.bind(Data_Either.bindEither)(Data_Traversable["for"](Data_Either.applicativeEither)(Data_Traversable.traversableArray)(v1.value0)(function (prop) {
                        return Prelude.bind(Data_Either.bindEither)(Data_Foreign_Index["!"](Data_Foreign_Index.indexString)(f)(prop.recLabel))(function (v2) {
                            return Prelude.bind(Data_Either.bindEither)(go(prop.recValue(Prelude.unit))(v2))(function (v3) {
                                return Prelude["return"](Data_Either.applicativeEither)({
                                    recLabel: prop.recLabel, 
                                    recValue: Prelude["const"](v3)
                                });
                            });
                        });
                    }))(function (v2) {
                        return Prelude["return"](Data_Either.applicativeEither)(new Data_Generic.SRecord(v2));
                    });
                };
                if (v1 instanceof Data_Generic.SigProd && (v1.value1.length === 1 && ((v1.value1[0]).sigValues.length === 1 && v.unwrapNewtypes))) {
                    return Prelude.bind(Data_Either.bindEither)(go((v1.value1[0]).sigValues[0](Prelude.unit))(f))(function (v2) {
                        return Prelude["return"](Data_Either.applicativeEither)(new Data_Generic.SProd((v1.value1[0]).sigConstructor, [ function (v3) {
                            return v2;
                        } ]));
                    });
                };
                if (v1 instanceof Data_Generic.SigProd && (v1.value0 === "Data.Maybe.Maybe" && (v1.value1.length === 2 && ((v1.value1[0]).sigValues.length === 1 && v.maybeAsNull)))) {
                    var $117 = Data_Foreign.isNull(f) || Data_Foreign.isUndefined(f);
                    if ($117) {
                        return Prelude["return"](Data_Either.applicativeEither)(new Data_Generic.SProd("Data.Maybe.Nothing", [  ]));
                    };
                    if (!$117) {
                        return Prelude.bind(Data_Either.bindEither)(go((v1.value1[0]).sigValues[0](Prelude.unit))(f))(function (v2) {
                            return Prelude["return"](Data_Either.applicativeEither)(new Data_Generic.SProd("Data.Maybe.Just", [ function (v3) {
                                return v2;
                            } ]));
                        });
                    };
                    throw new Error("Failed pattern match at Data.Foreign.Generic line 89, column 5 - line 93, column 3: " + [ $117.constructor.name ]);
                };
                if (v1 instanceof Data_Generic.SigProd && (v1.value0 === "Data.Tuple.Tuple" && (v1.value1.length === 1 && ((v1.value1[0]).sigValues.length === 2 && v.tupleAsArray)))) {
                    return Prelude.bind(Data_Either.bindEither)(Data_Foreign.readArray(f))(function (v2) {
                        if (v2.length === 2) {
                            return Prelude.bind(Data_Either.bindEither)(go((v1.value1[0]).sigValues[0](Prelude.unit))(v2[0]))(function (v3) {
                                return Prelude.bind(Data_Either.bindEither)(go((v1.value1[0]).sigValues[1](Prelude.unit))(v2[1]))(function (v4) {
                                    return Prelude["return"](Data_Either.applicativeEither)(new Data_Generic.SProd("Data.Tuple.Tuple", [ function (v5) {
                                        return v3;
                                    }, function (v5) {
                                        return v4;
                                    } ]));
                                });
                            });
                        };
                        return new Data_Either.Left(new Data_Foreign.TypeMismatch("array of length 2", "array"));
                    });
                };
                if (v1 instanceof Data_Generic.SigProd) {
                    return Prelude.bind(Data_Either.bindEither)(Prelude[">>="](Data_Either.bindEither)(Data_Foreign_Index.prop(v.sumEncoding.value0.tagFieldName)(f))(Data_Foreign.readString))(function (v2) {
                        var $142 = Data_Foldable.find(Data_Foldable.foldableArray)(function (alt) {
                            return alt.sigConstructor === v2;
                        })(v1.value1);
                        if ($142 instanceof Data_Maybe.Nothing) {
                            return new Data_Either.Left(new Data_Foreign.TypeMismatch("one of " + Prelude.show(Prelude.showArray(Prelude.showString))(Prelude.map(Prelude.functorArray)(function (v3) {
                                return v3.sigConstructor;
                            })(v1.value1)), v2));
                        };
                        if ($142 instanceof Data_Maybe.Just && $142.value0.sigValues.length === 0) {
                            return Prelude["return"](Data_Either.applicativeEither)(new Data_Generic.SProd(v2, [  ]));
                        };
                        if ($142 instanceof Data_Maybe.Just && ($142.value0.sigValues.length === 1 && v.unwrapSingleArgumentConstructors)) {
                            return Prelude.bind(Data_Either.bindEither)(Data_Foreign_Index.prop(v.sumEncoding.value0.contentsFieldName)(f))(function (v3) {
                                return Prelude.bind(Data_Either.bindEither)(go($142.value0.sigValues[0](Prelude.unit))(v3))(function (v4) {
                                    return Prelude["return"](Data_Either.applicativeEither)(new Data_Generic.SProd(v2, [ function (v5) {
                                        return v4;
                                    } ]));
                                });
                            });
                        };
                        if ($142 instanceof Data_Maybe.Just) {
                            return Prelude.bind(Data_Either.bindEither)(Prelude[">>="](Data_Either.bindEither)(Data_Foreign_Index.prop(v.sumEncoding.value0.contentsFieldName)(f))(Data_Foreign.readArray))(function (v3) {
                                return Prelude.bind(Data_Either.bindEither)(Data_Array.zipWithA(Data_Either.applicativeEither)(function (k) {
                                    return go(k(Prelude.unit));
                                })($142.value0.sigValues)(v3))(function (v4) {
                                    return Prelude["return"](Data_Either.applicativeEither)(new Data_Generic.SProd(v2, Prelude.map(Prelude.functorArray)(Prelude["const"])(v4)));
                                });
                            });
                        };
                        throw new Error("Failed pattern match at Data.Foreign.Generic line 105, column 9 - line 118, column 1: " + [ $142.constructor.name ]);
                    });
                };
                throw new Error("Failed pattern match at Data.Foreign.Generic line 68, column 3 - line 69, column 3: " + [ v1.constructor.name, f.constructor.name ]);
            };
        };
        var fromSpineUnsafe = function (sp) {
            var $160 = Data_Generic.fromSpine(dictGeneric)(sp);
            if ($160 instanceof Data_Maybe.Nothing) {
                return Control_Monad_Eff_Exception_Unsafe.unsafeThrow("Invalid spine for signature");
            };
            if ($160 instanceof Data_Maybe.Just) {
                return $160.value0;
            };
            throw new Error("Failed pattern match at Data.Foreign.Generic line 63, column 5 - line 67, column 3: " + [ $160.constructor.name ]);
        };
        return function ($170) {
            return Prelude.map(Data_Either.functorEither)(fromSpineUnsafe)(go(Data_Generic.toSignature(dictGeneric)((Type_Proxy["Proxy"]).value))($170));
        };
    };
};
var readJSONGeneric = function (dictGeneric) {
    return function (opts) {
        return Control_Bind[">=>"](Data_Either.bindEither)(Data_Foreign.parseJSON)(readGeneric(dictGeneric)(opts));
    };
};
var defaultOptions = {
    sumEncoding: new TaggedObject({
        tagFieldName: "tag", 
        contentsFieldName: "contents"
    }), 
    unwrapNewtypes: false, 
    unwrapSingleArgumentConstructors: true, 
    maybeAsNull: true, 
    tupleAsArray: false
};
module.exports = {
    TaggedObject: TaggedObject, 
    toJSONGeneric: toJSONGeneric, 
    readJSONGeneric: readJSONGeneric, 
    toForeignGeneric: toForeignGeneric, 
    readGeneric: readGeneric, 
    defaultOptions: defaultOptions
};
